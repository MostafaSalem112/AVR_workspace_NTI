/*
 * TIMER0_program.c
 *
 *  Created on: Oct 27, 2023
 *      Author: Mostafa_Salem
 */
#include "../../LIB/Bit_Math.h"
#include "../../LIB/STD_Types.h"
#include "TIMER0_private.h"
#include "TIMER0_config.h"
#include "TIMER0_interface.h"

u32 TIMER,PreLoad,PreScaler;

void TIMER0_voidEnable(){

	TCCR0->CS0 = CLOCK_PRESCALER;
}
void TIMER0_voidDisable(){

	TCCR0->CS0 = Timer_Counter_stopped;
}
void TIMER0_INITIALZE(){

	TCCR0->FOC0 = Force_Output_Compare_STATUS;

	TCCR0->WGM00 = GET_BIT(TIMER_MODE,WGM00_BIT);
	TCCR0->WGM01 = GET_BIT(TIMER_MODE,WGM01_BIT);

	TCCR0->COM0 = Compare_Output_Mode;

	TIMSK->TOIE0 = Overflow_Interrupt_Status;
	TIMSK->OCIE0 = Compare_Match_Interrupt_Status;
}
void TIMER0_voidPreLoad(u8 Copy_u8Value){

	TCNT0 = Copy_u8Value;
}
void TIMER0_voidSetTimer(u32 Copy_u32TimeMS){

	u32 MAX_NUM = 256;
	u32 PREESCALER;


#if CLOCK_PRESCALER == No_prescaling
	PREESCALER = 1;
#elif CLOCK_PRESCALER == clkIO_8
	PREESCALER = 8;
#elif CLOCK_PRESCALER == clkIO_64
	PREESCALER = 64;
#elif CLOCK_PRESCALER == clkIO_256
	PREESCALER = 256;
#elif CLOCK_PRESCALER == 1024
	PREESCALER = 1024;
#endif

	u32 TIMER_freq=SYSTEM_CLOCK_FREQUENCY/PREESCALER;
	f32 Tick_Time=MICRO_IN_SEC/TIMER_freq;
	f32 Tick_Time= PREESCALER/SYSTEM_CLOCK_FREQUENCY;
	u32 OverFlow_Time=Tick_Time*MAX_NUM;

	TIMER=(Copy_u32TimeMS*MICRO_IN_MILLI)/OverFlow_Time;
	f32 remainder=((Copy_u32TimeMS*MICRO_IN_MILLI)%OverFlow_Time)/(f32)OverFlow_Time;
	PreLoad=(1-remainder)*MAX_NUM;

	TIMER0_voidPreLoad(PreLoad);
}
